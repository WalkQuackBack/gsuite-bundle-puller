/* ==UserStyle==
@name           M3 Google Docs
@namespace      github.com/walkquackback/dark-theme-google-docs
@version        0.0.0
@description    A new userstyle
@author         walkquackback
@license        MIT

@preprocessor   less

@var            select dark "Theme" {
    "Dark": "true",
    "Light": "false"
}

==/UserStyle== */

// Colors

// @dark: true;

@iconFilter: if((@dark), invert(1) hue-rotate(180deg), unset);

@gm3-sys-color-error: if(@dark, #f2b8b5, #b3261e);
@gm3-sys-color-on-error: if(@dark, #601410, #fff);
@gm3-sys-color-background: if(@dark, #131314, #fff);
@gm3-sys-color-on-background: if(@dark, #e3e3e3, #1f1f1f);
@gm3-sys-color-primary: if(@dark, #a8c7fa, #0b57d0);
@gm3-sys-color-on-primary: if(@dark, #062e6f, #fff);
@gm3-sys-color-inverse-primary: if(@dark, #0b57d0, #a8c7fa);
@gm3-sys-color-secondary: if(@dark, #7fcfff, #00639b);
@gm3-sys-color-on-secondary: if(@dark, #035, #fff);
@gm3-sys-color-surface: if(@dark, #131314, #fff);
@gm3-sys-color-on-surface: if(@dark, #e3e3e3, #1f1f1f);
@gm3-sys-color-on-surface-variant: if(@dark, #c4c7c5, #444746);
@gm3-sys-color-inverse-on-surface: if(@dark, #303030, #f2f2f2);
@gm3-sys-color-inverse-surface: if(@dark, #e3e3e3, #303030);
@gm3-sys-color-shadow: if(@dark, #000, #000);
@gm3-sys-color-primary-container: if(@dark, #0842a0, #d3e3fd);
@gm3-sys-color-on-primary-container: if(@dark, #d3e3fd, #041e49);
@gm3-sys-color-secondary-container: if(@dark, #004a77, #c2e7ff);
@gm3-sys-color-on-secondary-container: if(@dark, #c2e7ff, #001d35);
@gm3-sys-color-error-container: if(@dark, #8c1d18, #f9dedc);
@gm3-sys-color-on-error-container: if(@dark, #f9dedc, #410e0b);
@gm3-sys-color-surface-bright: if(@dark, #37393b, #fff);
@gm3-sys-color-surface-variant: if(@dark, #444746, #e1e3e1);
@gm3-sys-color-surface-tint: if(@dark, #d1e1ff, #6991d6);
@gm3-sys-color-surface-container-lowest: if(@dark, #0e0e0e, #fff);
@gm3-sys-color-surface-container-low: if(@dark, #1b1b1b, #f8fafd);
@gm3-sys-color-surface-container: if(@dark, #1e1f20, #f0f4f9);
@gm3-sys-color-surface-container-high: if(@dark, #282a2c, #e9eef6);
@gm3-sys-color-surface-container-highest: if(@dark, #333537, #dde3ea);
@gm3-sys-color-tertiary: if(@dark, #6dd58c, #146c2e);
@gm3-sys-color-on-tertiary: if(@dark, #0a3818, #fff);
@gm3-sys-color-tertiary-container: if(@dark, #0f5223, #c4eed0);
@gm3-sys-color-outline: if(@dark, #8e918f, #747775);
@gm3-sys-color-outline-variant: if(@dark, #444746, #c4c7c5);
@gm3-sys-color-scrim: if(@dark, #000, #000);

@gm3-sys-color-error-rgb: #rgbify(@gm3-sys-color-error)[];
@gm3-sys-color-on-error-rgb: #rgbify(@gm3-sys-color-on-error)[];
@gm3-sys-color-background-rgb: #rgbify(@gm3-sys-color-background)[];
@gm3-sys-color-on-background-rgb: #rgbify(@gm3-sys-color-on-background)[];
@gm3-sys-color-primary-rgb: #rgbify(@gm3-sys-color-primary)[];
@gm3-sys-color-on-primary-rgb: #rgbify(@gm3-sys-color-on-primary)[];
@gm3-sys-color-inverse-primary-rgb: #rgbify(@gm3-sys-color-inverse-primary)[];
@gm3-sys-color-secondary-rgb: #rgbify(@gm3-sys-color-secondary)[];
@gm3-sys-color-on-secondary-rgb: #rgbify(@gm3-sys-color-on-secondary)[];
@gm3-sys-color-surface-rgb: #rgbify(@gm3-sys-color-surface)[];
@gm3-sys-color-on-surface-rgb: #rgbify(@gm3-sys-color-on-surface)[];
@gm3-sys-color-on-surface-variant-rgb: #rgbify(
    @gm3-sys-color-on-surface-variant,
)[];
@gm3-sys-color-inverse-on-surface-rgb: #rgbify(
    @gm3-sys-color-inverse-on-surface,
)[];
@gm3-sys-color-inverse-surface-rgb: #rgbify(@gm3-sys-color-inverse-surface)[];
@gm3-sys-color-shadow-rgb: #rgbify(@gm3-sys-color-shadow)[];
@gm3-sys-color-primary-container-rgb: #rgbify(
    @gm3-sys-color-primary-container,
)[];
@gm3-sys-color-on-primary-container-rgb: #rgbify(
    @gm3-sys-color-on-primary-container,
)[];
@gm3-sys-color-secondary-container-rgb: #rgbify(
    @gm3-sys-color-secondary-container,
)[];
@gm3-sys-color-on-secondary-container-rgb: #rgbify(
    @gm3-sys-color-on-secondary-container,
)[];
@gm3-sys-color-error-container-rgb: #rgbify(@gm3-sys-color-error-container)[];
@gm3-sys-color-on-error-container-rgb: #rgbify(
    @gm3-sys-color-on-error-container,
)[];
@gm3-sys-color-surface-bright-rgb: #rgbify(@gm3-sys-color-surface-bright)[];
@gm3-sys-color-surface-variant-rgb: #rgbify(@gm3-sys-color-surface-variant)[];
@gm3-sys-color-surface-tint-rgb: #rgbify(@gm3-sys-color-surface-tint)[];
@gm3-sys-color-surface-container-lowest-rgb: #rgbify(
    @gm3-sys-color-surface-container-lowest,
)[];
@gm3-sys-color-surface-container-low-rgb: #rgbify(
    @gm3-sys-color-surface-container-low,
)[];
@gm3-sys-color-surface-container-rgb: #rgbify(
    @gm3-sys-color-surface-container,
)[];
@gm3-sys-color-surface-container-high-rgb: #rgbify(
    @gm3-sys-color-surface-container-high,
)[];
@gm3-sys-color-surface-container-highest-rgb: #rgbify(
    @gm3-sys-color-surface-container-highest,
)[];
@gm3-sys-color-tertiary-rgb: #rgbify(@gm3-sys-color-tertiary)[];
@gm3-sys-color-on-tertiary-rgb: #rgbify(@gm3-sys-color-on-tertiary)[];
@gm3-sys-color-tertiary-container-rgb: #rgbify(
    @gm3-sys-color-tertiary-container,
)[];
@gm3-sys-color-outline-rgb: #rgbify(@gm3-sys-color-outline)[];
@gm3-sys-color-outline-variant-rgb: #rgbify(@gm3-sys-color-outline-variant)[];
@gm3-sys-color-scrim-rgb: #rgbify(@gm3-sys-color-scrim)[];

// Shadows

@elevation1:
    0px 3px 1px -2px rgb(var(--gm3-sys-color-shadow-rgb, 0, 0, 0), 0.3),
    0px 2px 2px 0px rgb(var(--gm3-sys-color-shadow-rgb, 0, 0, 0), 0.14),
    0px 1px 5px 0px rgb(var(--gm3-sys-color-shadow-rgb, 0, 0, 0), 0.12);
@elevation2:
    0px 2px 4px -1px rgb(var(--gm3-sys-color-shadow-rgb, 0, 0, 0), 0.3),
    0px 4px 5px 0px rgb(var(--gm3-sys-color-shadow-rgb, 0, 0, 0), 0.14),
    0px 1px 10px 0px rgb(var(--gm3-sys-color-shadow-rgb, 0, 0, 0), 0.12);
@elevation3:
    0px 5px 5px -3px rgb(var(--gm3-sys-color-shadow-rgb, 0, 0, 0), 0.3),
    0px 8px 10px 1px rgb(var(--gm3-sys-color-shadow-rgb, 0, 0, 0), 0.14),
    0px 3px 14px 2px rgb(var(--gm3-sys-color-shadow-rgb, 0, 0, 0), 0.12);
@elevation4:
    0px 5px 5px -3px rgb(var(--gm3-sys-color-shadow-rgb, 0, 0, 0), 0.3),
    0px 8px 10px 1px rgb(var(--gm3-sys-color-shadow-rgb, 0, 0, 0), 0.14),
    0px 3px 14px 2px rgb(var(--gm3-sys-color-shadow-rgb, 0, 0, 0), 0.12);
@elevation5:
    0px 8px 10px -6px rgb(var(--gm3-sys-color-shadow-rgb, 0, 0, 0), 0.3),
    0px 16px 24px 2px rgb(var(--gm3-sys-color-shadow-rgb, 0, 0, 0), 0.14),
    0px 6px 30px 5px rgb(var(--gm3-sys-color-shadow-rgb, 0, 0, 0), 0.12);

#rgbify(@color) {
    @rgb: red(@color), green(@color), blue(@color);
}

@-moz-document url-prefix("https://docs.google.com/document/d/") {
    /**** Generated code START ****/
    /**** Generated code REPLACE ****/
    /**** Generated code END****/

    /* Subjective M3 changes */
    // Font family parity
    .goog-menu,
    .ac-renderer,
    .docs-omnibox-row-content {
        font-family: "Google Sans Text", "Google Sans", "Roboto";
    }

    // Shadows

    .docs-gm .goog-menu,
    .goog-menu,
    .ac-renderer,
    .document-details-bubble-container,
    .docs-gm .docs-toolbar-more-bubble,
    .docs-material.docs-toolbar-more-bubble,
    .peoplekitComponentsAutocompletePopupContainer {
        box-shadow: @elevation2;
    }

    .docs-gm .docos-anchoreddocoview.docos-docoview-active,
    .docs-grille-gm3 .docos-anchoreddocoview.docos-docoview-active,
    .docs-grille-gm3 .docos-anchoreddocoview.docos-docoview-active:hover,
    .docs-checkupdialog-content-container,
    .docsEmojisWizEmojiPickerTab {
        box-shadow: @elevation3;
    }

    // Core HTML elements

    hr {
        border-color: var(--gm3-sys-color-outline-variant);
    }

    input {
        background: transparent;
        color: inherit;
    }

    // Companion app switcher + toolbars
    .docs-grille-gm3
        .docs-companion-app-switcher-container:not(
            .docs-companion-app-switcher-container-collapsed
        ) {
        clip-path: inset(8px round 21px);
        background-color: var(--gm3-sys-color-surface-container);
        padding: 16px 0;
    }

    .app-switcher-button {
        width: 40px;
        height: 40px;
        left: 8px;
    }

    .app-switcher-button-icon-container {
        inset: -1px 0;
    }

    .app-switcher-button-icon-background {
        inset: 4px 5px;
        width: 30px;
        height: 30px;
        border-radius: 4px;
    }

    .agca-gab-icon-selection-indicator {
        visibility: hidden;
    }

    .companion-app-switcher-separator {
        padding-bottom: 0;
        margin-top: 4px;
    }

    .share-client-content-iframe {
        color-scheme: none;
    }

    // Legacy equations

    .kix-equation-toolbar-palette .goog-palette-cell {
        padding: 2px;
    }

    .kix-equation-toolbar-palette-item {
        border-color: transparent;
        position: relative;
        border-radius: 4px;
        background-image: none;
    }

    .goog-control-hover .kix-equation-toolbar-palette-item::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: inherit;

        outline-style: solid;
        outline-width: var(--gm3-focus-ring-inward-track-width, 3px);
        outline-color: var(--gm3-sys-color-secondary);
    }

    .kix-equation-toolbar-palette-item::after {
        content: "";
        position: absolute;
        inset: 0;
        background-position: inherit;
        background-image: url(https://ssl.gstatic.com/docs/common/ee-palettes-2.gif);
    }

    // Icon filters
    .apps-share-sprite,
    .docs-material.goog-menu
        .goog-menuitem.goog-option-selected
        .goog-menuitem-checkbox,
    .premiumFeatureDialogTitleIcon,
    .docs-revisions-icon,
    .app-switcher-button-icon-container[style="background-image: url(https://fonts.gstatic.com/s/i/googlematerialicons/add/v21/black-24dp/1x/gm_add_black_24dp.png)"],
    .ita-kd-img {
        filter: if((@dark), brightness(0) invert(1), unset) !important;
        filter: @iconFilter !important;
    }

    *[fill="#000"] {
        fill: var(--gm3-sys-color-on-surface) !important;
    }

    *[fill="#1a73e8"] {
        fill: var(--gm3-sys-color-primary) !important;
    }

    .docs-material-gm-labeled-checkbox-checkbox.docs-material-gm-labeled-checkbox-checked:before,
    div.docs-material-gm-checkbox-checked:before,
    span.docs-material-gm-checkbox-checked:before {
        filter: if((@dark), brightness(0.1), unset);
    }

    .kix-equation-toolbar-icon,
    .kix-equation-toolbar-palette-item::after {
        filter: if((@dark), brightness(0.75) invert(1), unset);
    }

    .docs-grille-gm3 .share-butter-icon {
        filter: if((@dark), invert(0), unset) !important;
    }

    // Legacy keyboard...

    .vk-box {
        border-radius: 12px;
        background-color: var(--gm3-sys-color-surface-container-low);
        color: var(--gm3-sys-color-on-surface);
        font: inherit;
        * {
            color: inherit !important;
            font-family: inherit;
        }
        .vk-btn {
            background: var(--gm3-sys-color-surface-container-high);
            border-radius: 6px;
            border-color: var(--gm3-sys-color-outline-variant);
            &.vk-sf-h {
                border-color: var(--gm3-sys-color-outline);
                background: var(--gm3-sys-color-surface-container-highest);
            }
            &.vk-sf-s {
                border-color: var(--gm3-sys-color-secondary);
            }
        }
    }

    // Table size picker

    .goog-dimension-picker div.goog-dimension-picker-highlighted {
        filter: saturate(2);
    }
    .goog-dimension-picker-unhighlighted {
        background-image: e;
    }

    // JFK focus outline
    .docs-gm .jfk-button.jfk-button-focused,
    .docs-gm .docs-material-gm-dialog-title-close:focus,
    .docs-gm .docos-overflowmenu-outer > .docos-docomenu-dropdown:focus,
    .docs-material-menu-button-flat-default-focused,
    .goog-flat-button-focused,
    .docs-material-button-focused,
    .docs-sidebar-gm-titlebar-icon-button:focus,
    .docs-material-gm-checkbox.docs-material-gm-checkbox-focused,
    // !!!
    .docs-gm
        .docs-docos-activity-sidebar
        .docos-subscription-settings-button
        .docs-material-button.docs-material-button-focused,
    .docs-gm.docos-xeditor
        .docos-search-button
        .docs-material-button.docs-material-button-focused,
    .docs-gm.docos-xeditor
        .docos-subscription-settings-button
        .docs-material-button.docs-material-button-focused {
        &:is(*):is(*):is(*) {
            outline-style: solid;
            outline-width: 3px;
            outline-offset: 2px;
            outline-color: var(--gm3-sys-color-primary);

            animation-name: outward-grow, outward-shrink;
            animation-delay:
                0s,
                calc(var(--gm3-focus-ring-duration, 600ms) * 0.25);
            animation-duration:
                calc(var(--gm3-focus-ring-duration, 600ms) * 0.25),
                calc(var(--gm3-focus-ring-duration, 600ms) * 0.75);
            animation-timing-function: cubic-bezier(0.2, 0, 0, 1);
            color: var(
                --gm3-focus-ring-color,
                var(--gm3-sys-color-secondary, #625b71)
            );
            //     box-sizing: border-box;
            // display: none;
            // pointer-events: none;
            // position: absolute;
        }
    }

    @keyframes outward-grow {
        from {
            outline-width: 0;
        }

        to {
            outline-width: var(--md-focus-ring-active-width, 8px);
        }
    }

    @keyframes outward-shrink {
        from {
            outline-width: var(--md-focus-ring-active-width, 8px);
        }
    }

    // Misc color overrides
    // Main appview background
    body:not(.docs-body-pageless) .kix-appview-editor {
        background: var(--gm3-sys-color-surface-container-lowest) !important;
    }

    .docs-body-pageless .kix-appview-editor {
        background-image: none !important;
    }

    .docs-grille-gm3 .docs-ui-toast {
        background: var(--gm3-sys-color-inverse-surface);
        color: var(--gm3-sys-color-inverse-on-surface);
        box-shadow: @elevation3;
    }

    // Scrims
    .docs-gm div.goog-modalpopup-bg,
    .docs-gm div.modal-dialog-bg,
    .docs-material-gm-dialog-bg {
        background-color: var(--gm3-sys-color-scrim) !important;
    }
    #docos-shadow {
        background-color: color-mix(
            in oklab,
            transparent,
            var(--gm3-sys-color-scrim) 50%
        );
    }

    // Emoji reaction box shadow
    .docos-emoji-counter-button-tooltip {
        box-shadow: none;
    }

    // Fix for colour pickers
    // Legacy
    .docs-material-color-picker-value-overlay {
        background: linear-gradient(180deg, transparent 0, #000);
    }
    .docs-material-color-picker-saturation-overlay {
        background: linear-gradient(90deg, #fff 0, hsla(0, 0%, 100%, 0));
    }

    // GM3
    .appsElementsColorPickerColorMap-color-map__background--transparent-to-black {
        background: linear-gradient(in oklab to bottom, transparent, #000);
    }
    .appsElementsColorPickerColorMap-color-map__background--white-to-transparent {
        background: linear-gradient(in oklab to right, #fff, transparent);
    }

    // Building blocks preview
    .unifiedPreviewBubbleRoot.docs-bubble {
        background: #fff;
    }

    // Font picker font BG
    .goog-menuitem.docs-submenuitem .goog-menuitem-content {
        background-color: transparent !important;
    }

    // Tab picker selected icon
    .chapter-item-label-and-buttons-container-selected
        .chapter-item-icon
        .docs-icon-editors-ia-article-document {
        filter: brightness(0) saturate(100%) invert(12%) sepia(17%) saturate(
            6039%
        ) hue-rotate(199deg) brightness(93%) contrast(106%) invert(1)
            hue-rotate(180deg);
    }

    // Hacks
    .companion-tooltip {
        pointer-events: none;
        user-select: none;
    }

    // \/\/ I forgot what this did :(
    .goog-menuitem.docs-submenuitem .goog-menuitem-content {
        background-color: #fff;
    }

    // Variables/Core

    ::selection {
        background-color: var(--gm3-sys-color-primary);
        color: var(--gm3-sys-color-on-primary);
    }

    .docsCommonWiz {
        /*Apply class aRDKUe, P9KVBf, LgGVmb on some dialogs to make them dark
            but this is controlled by Wiz, you'd need userscript to make
            work properly. D:*/
        --gm3-sys-color-error: @gm3-sys-color-error;
        --gm3-sys-color-on-error: @gm3-sys-color-on-error;
        --gm3-sys-color-background: @gm3-sys-color-background;
        --gm3-sys-color-on-background: @gm3-sys-color-on-background;
        --gm3-sys-color-primary: @gm3-sys-color-primary;
        --gm3-sys-color-on-primary: @gm3-sys-color-on-primary;
        --gm3-sys-color-inverse-primary: @gm3-sys-color-inverse-primary;
        --gm3-sys-color-secondary: @gm3-sys-color-secondary;
        --gm3-sys-color-on-secondary: @gm3-sys-color-on-secondary;
        --gm3-sys-color-surface: @gm3-sys-color-surface;
        --gm3-sys-color-on-surface: @gm3-sys-color-on-surface;
        --gm3-sys-color-on-surface-variant: @gm3-sys-color-on-surface-variant;
        --gm3-sys-color-inverse-on-surface: @gm3-sys-color-inverse-on-surface;
        --gm3-sys-color-inverse-surface: @gm3-sys-color-inverse-surface;
        --gm3-sys-color-shadow: @gm3-sys-color-shadow;
        --gm3-sys-color-primary-container: @gm3-sys-color-primary-container;
        --gm3-sys-color-on-primary-container: @gm3-sys-color-on-primary-container;
        --gm3-sys-color-secondary-container: @gm3-sys-color-secondary-container;
        --gm3-sys-color-on-secondary-container: @gm3-sys-color-on-secondary-container;
        --gm3-sys-color-error-container: @gm3-sys-color-error-container;
        --gm3-sys-color-on-error-container: @gm3-sys-color-on-error-container;
        --gm3-sys-color-surface-bright: @gm3-sys-color-surface-bright;
        --gm3-sys-color-surface-variant: @gm3-sys-color-surface-variant;
        --gm3-sys-color-surface-tint: @gm3-sys-color-surface-tint;
        --gm3-sys-color-surface-container-lowest: @gm3-sys-color-surface-container-lowest;
        --gm3-sys-color-surface-container-low: @gm3-sys-color-surface-container-low;
        --gm3-sys-color-surface-container: @gm3-sys-color-surface-container;
        --gm3-sys-color-surface-container-high: @gm3-sys-color-surface-container-high;
        --gm3-sys-color-surface-container-highest: @gm3-sys-color-surface-container-highest;
        --gm3-sys-color-tertiary: @gm3-sys-color-tertiary;
        --gm3-sys-color-on-tertiary: @gm3-sys-color-on-tertiary;
        --gm3-sys-color-tertiary-container: @gm3-sys-color-tertiary-container;
        --gm3-sys-color-outline: @gm3-sys-color-outline;
        --gm3-sys-color-outline-variant: @gm3-sys-color-outline-variant;
        --gm3-sys-color-scrim: @gm3-sys-color-scrim;
        color-scheme: dark;

        --gm3-data-table-row-item-unselected-container-color: transparent;

        --gm3-dialog-container-color: var(
            --gm3-sys-color-surface-container,
            #fff
        );
        --gm3-dialog-z-index: 1003;
        --gm3-select-shared-menu-container-color: var(
            --gm3-sys-color-surface-bright,
            #fff
        );
        --gm3-menu-list-item-label-text-font:
            "Google Sans Flex","Google Sans",Roboto,Arial,sans-serif;
        --gm3-slider-value-indicator-label-label-text-font: "Google Sans";
        --gm3-autocomplete-outlined-text-field-input-text-font: "Google Sans";
        --gm3-autocomplete-outlined-text-field-label-text-font: "Google Sans";
        --gm3-autocomplete-outlined-text-field-supporting-text-font: "Google Sans";
        --gm3-autocomplete-outlined-menu-list-item-label-text-font: "Google Sans";
        --gm3-navigation-drawer-content-label-text-font: "Google Sans";
        --ae-side-sheet-container-color: var(
            --gm3-sys-color-surface-container,
            #f0f4f9
        );
        --ae-side-sheet-outline-width: 0px;
        --gm3-dropdown-button-outlined-hover-state-layer-opacity: 0;
        --gm3-dropdown-button-outlined-pressed-state-layer-opacity: 0;
        --gm3-dropdown-button-outlined-hover-outline-color: var(
            --gm3-sys-color-on-surface,
            #1f1f1f
        );
        --gm3-dropdown-button-outlined-pressed-outline-color: var(
            --gm3-sys-color-primary,
            #0b57d0
        );
    }

    .docsCommonWizDialogDialogContent {
        --gm3-tabs-primary-container-color: transparent;
    }

    // .docsCommonWizDialogDialogContent {
    //     --gm3-select-shared-text-field-container-height: 40px;
    //     --gm3-select-shared-text-field-input-text-size: 16px;
    //     --gm3-select-outlined-text-field-container-height: 40px;
    //     --gm3-text-field-outlined-container-height: 40px;
    //     --gm3-button-filled-container-height: 40px;
    //     --gm3-button-outlined-container-height: 40px;
    //     --gm3-button-text-container-height: 40px;
    //     --gm3-button-filled-tonal-container-height: 40px;
    //     --gm3-checkbox-container-size: 18px;
    //     --gm3-checkbox-state-layer-size: 36px;
    //     --gm3-checkbox-touch-target-size: 0px;
    //     --gm3-checkbox-label-text-size: 0.875rem;
    //     --gm3-radio-state-layer-size: 36px;
    //     --gm3-radio-label-text-size: 0.875rem;
    //     --gm3-tabs-primary-container-color: var(--gm3-sys-color-surface, #fff);
    // }

    body {
        color: var(--gm3-sys-color-on-surface);
    }
}
